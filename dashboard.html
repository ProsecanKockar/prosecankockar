<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Prosečan Kockar - Dashboard</title>
<style>
body {
background-color: #121212;
color: white;
font-family: Arial, sans-serif;
padding: 20px;
text-align: center;
}

h1 {
color: #00ffcc;
}

.section {
margin-top: 40px;
}

.match, .bet, .user {
background-color: #1e1e1e;
padding: 15px;
margin: 10px auto;
border-radius: 8px;
width: 90%;
max-width: 500px;
text-align: left;
}

select, input[type="number"], button {
margin-top: 5px;
width: 100%;
padding: 8px;
margin-bottom: 10px;
border-radius: 4px;
border: none;
}

button {
background-color: #00ffcc;
color: black;
font-weight: bold;
cursor: pointer;
}

button:hover {
background-color: #00ccaa;
}
</style>
</head>
<body>
<h1>Dobrodošli na Prosečan Kockar</h1>

<div class="section" id="mecevi">
<h2>Dostupni Mečevi</h2>
<!-- Mečevi se dinamički ubacuju ovde -->
</div>

<div class="section" id="aktivne-opklade">
<h2>Aktivne Opklade</h2>
</div>

<div class="section" id="prosle-opklade">
<h2>Prošle Opklade</h2>
</div>

<div class="section" id="rang-lista">
<h2>Rang Lista</h2>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
// Tvoj API key i konfiguracija
const firebaseConfig = {
apiKey: "AIzaSyB6HgVAePwyqCmMZFC_-xOgOF-gZLT9g20",
authDomain: "prosecankockar-a1c15.firebaseapp.com",
projectId: "prosecankockar-a1c15",
storageBucket: "prosecankockar-a1c15.appspot.com",
messagingSenderId: "968186282419",
appId: "1:968186282419:web:8e92d1926e53150a9c0bc6"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

// Dummy korisnik dok ne napravimo login
const currentUser = { uid: "testKorisnik" };

async function loadMatches() {
const container = document.getElementById("mecevi");
const snapshot = await db.collection("matches").get();
container.innerHTML = "<h2>Dostupni Mečevi</h2>";

snapshot.forEach(doc => {
const data = doc.data();
const div = document.createElement("div");
div.className = "match";

div.innerHTML = `
<strong>${data.teams}</strong><br/>
<label for="prediction-${doc.id}">Izaberi pobednika:</label>
<select id="prediction-${doc.id}">
<option value="${data.team1}">${data.team1}</option>
<option value="${data.team2}">${data.team2}</option>
</select><br/>
<label for="stake-${doc.id}">Ulog:</label>
<input type="number" id="stake-${doc.id}" placeholder="Unesi ulog" min="1" /><br/>
<button onclick="placeBet('${doc.id}', '${data.teams}')">Postavi opkladu</button>
`;

container.appendChild(div);
});
}

async function placeBet(matchId, teams) {
const prediction = document.getElementById(`prediction-${matchId}`).value;
const stake = parseInt(document.getElementById(`stake-${matchId}`).value);

if (!stake || stake <= 0) {
alert("Unesi validan ulog!");
return;
}

await db.collection("bets").add({
userId: currentUser.uid,
matchId,
prediction,
stake,
status: "active",
timestamp: firebase.firestore.FieldValue.serverTimestamp()
});

alert("Opklada postavljena!");
loadUserBets();
}

async function loadUserBets() {
const activeContainer = document.getElementById("aktivne-opklade");
const pastContainer = document.getElementById("prosle-opklade");

const snapshot = await db.collection("bets").where("userId", "==", currentUser.uid).get();
activeContainer.innerHTML = "<h2>Aktivne Opklade</h2>";
pastContainer.innerHTML = "<h2>Prošle Opklade</h2>";

snapshot.forEach(doc => {
const data = doc.data();
const div = document.createElement("div");
div.className = "bet";
div.innerHTML = `
<strong>${data.prediction}</strong> | Ulog: ${data.stake} | Status: ${data.status}
`;
if (data.status === "active") {
activeContainer.appendChild(div);
} else {
pastContainer.appendChild(div);
}
});
}

async function loadLeaderboard() {
const container = document.getElementById("rang-lista");
const snapshot = await db.collection("users").orderBy("balance", "desc").limit(10).get();

container.innerHTML = "<h2>Rang Lista</h2>";
snapshot.forEach(doc => {
const data = doc.data();
const div = document.createElement("div");
div.className = "user";
div.textContent = `${data.username || "Nepoznat"} - Saldo: ${data.balance || 0}`;
container.appendChild(div);
});
}

window.onload = () => {
loadMatches();
loadUserBets();
loadLeaderboard();
};
</script>
</body>
</html>
