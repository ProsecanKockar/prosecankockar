<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Prosečan Kockar - Dashboard</title>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<style>
body {
background-color: #121212;
color: #f1f1f1;
font-family: 'Segoe UI', sans-serif;
padding: 20px;
display: flex;
flex-direction: column;
align-items: center;
}

h1, h2 {
color: #00ffcc;
text-align: center;
}

table {
width: 100%;
max-width: 700px;
border-collapse: collapse;
margin-top: 20px;
background-color: #1e1e1e;
border-radius: 8px;
overflow: hidden;
box-shadow: 0 0 10px #00ffcc33;
}

th, td {
padding: 12px;
border-bottom: 1px solid #333;
text-align: center;
}

th {
background-color: #222;
color: #00ffcc;
}

tr:last-child td {
border-bottom: none;
}

#betting-form {
margin-top: 40px;
padding: 20px;
max-width: 400px;
background-color: #1a1a1a;
border-radius: 8px;
box-shadow: 0 0 10px #00ffcc33;
}

#betting-form h2 {
text-align: center;
margin-bottom: 20px;
color: #00ffcc;
}

#betting-form label {
display: block;
margin-top: 10px;
}

#betting-form input,
#betting-form select {
width: 100%;
padding: 10px;
margin-top: 5px;
background-color: #222;
color: #fff;
border: 1px solid #444;
border-radius: 4px;
box-sizing: border-box;
}

#betting-form button {
width: 100%;
margin-top: 15px;
padding: 12px;
background-color: #00ffcc;
color: #000;
border: none;
border-radius: 4px;
font-weight: bold;
transition: background 0.3s;
cursor: pointer;
}

#betting-form button:hover {
background-color: #00ccaa;
}

#betting-message {
margin-top: 10px;
text-align: center;
font-weight: bold;
color: lime;
}

#my-bets {
margin-top: 50px;
}

#my-bets h2 {
margin-bottom: 10px;
}
</style>
</head>
<body>
<h1>Dobrodošao na Prosečan Kockar</h1>

<!-- Rang lista korisnika -->
<h2>Rang Lista</h2>
<table id="leaderboard">
<thead>
<tr>
<th>#</th>
<th>Korisnik</th>
<th>Saldo</th>
</tr>
</thead>
<tbody></tbody>
</table>

<!-- Forma za klađenje -->
<div id="betting-form">
<h2>Postavi Opkladu</h2>

<label for="match">Izaberi meč:</label>
<select id="match">
<option value="teamA_vs_teamB">Team A vs Team B</option>
<option value="teamC_vs_teamD">Team C vs Team D</option>
</select>

<label for="prediction">Tvoj tip (1, X, 2):</label>
<input type="text" id="prediction" maxlength="1" placeholder="npr. 1">

<label for="stake">Ulog (npr. 100):</label>
<input type="number" id="stake" min="1">

<button onclick="placeBet()">Postavi opkladu</button>

<p id="betting-message"></p>
</div>

<!-- Tvoje opklade -->
<div id="my-bets">
<h2>Tvoje Opklade</h2>
<table>
<thead>
<tr>
<th>Meč</th>
<th>Tip</th>
<th>Ulog</th>
<th>Status</th>
<th>Datum</th>
</tr>
</thead>
<tbody id="bets-body"></tbody>
</table>
</div>

<!-- Firebase konfiguracija -->
<script>
const firebaseConfig = {
apiKey: "AIzaSyB6HgVAePwyqCmMZFC_-xOgOF-gZLT9g20",
authDomain: "prosecankockar-a1c15.firebaseapp.com",
projectId: "prosecankockar-a1c15",
storageBucket: "prosecankockar-a1c15.appspot.com",
messagingSenderId: "968186282419",
appId: "1:968186282419:web:8e92d1926e53150a9c0bc6"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();
</script>

<!-- Logika -->
<script>
function loadLeaderboard() {
db.collection("users").orderBy("balance", "desc").get()
.then(snapshot => {
const tbody = document.querySelector("#leaderboard tbody");
tbody.innerHTML = "";
let rank = 1;
snapshot.forEach(doc => {
const user = doc.data();
const tr = document.createElement("tr");
tr.innerHTML = `
<td>${rank++}</td>
<td>${user.username || "Nepoznat"}</td>
<td>${user.balance || 0}</td>
`;
tbody.appendChild(tr);
});
});
}

async function placeBet() {
const match = document.getElementById("match").value;
const prediction = document.getElementById("prediction").value.trim().toUpperCase();
const stake = parseInt(document.getElementById("stake").value);
const message = document.getElementById("betting-message");

if (!["1", "X", "2"].includes(prediction)) {
message.textContent = "Tip mora biti 1, X ili 2.";
return;
}
if (isNaN(stake) || stake <= 0) {
message.textContent = "Ulog mora biti veći od 0.";
return;
}

const user = firebase.auth().currentUser;
if (!user) {
message.textContent = "Morate biti prijavljeni.";
return;
}

const userId = user.uid;
const userRef = db.collection("users").doc(userId);

try {
const userDoc = await userRef.get();
const userData = userDoc.data();

if (userData.balance < stake) {
message.textContent = "Nemate dovoljno sredstava.";
return;
}

await userRef.update({
balance: firebase.firestore.FieldValue.increment(-stake)
});

await db.collection("bets").add({
userId: userId,
match: match,
prediction: prediction,
stake: stake,
result: null,
createdAt: firebase.firestore.FieldValue.serverTimestamp()
});

message.textContent = "Opklada uspešno postavljena!";
loadLeaderboard();
loadUserBets();
} catch (error) {
console.error("Greška:", error);
message.textContent = "Došlo je do greške.";
}
}

async function loadUserBets() {
const user = firebase.auth().currentUser;
if (!user) return;

const betsRef = db.collection("bets")
.where("userId", "==", user.uid)
.orderBy("createdAt", "desc");

const snapshot = await betsRef.get();
const tbody = document.getElementById("bets-body");
tbody.innerHTML = "";

snapshot.forEach(doc => {
const bet = doc.data();
const status = bet.result === "win" ? "Dobitak" :
bet.result === "lose" ? "Promašaj" :
"Aktivna";

const tr = document.createElement("tr");
const date = bet.createdAt?.toDate().toLocaleString("sr-RS") || "Nepoznato";

tr.innerHTML = `
<td>${bet.match}</td>
<td>${bet.prediction}</td>
<td>${bet.stake}</td>
<td>${status}</td>
<td>${date}</td>
`;
tbody.appendChild(tr);
});
}

auth.onAuthStateChanged(user => {
if (user) {
loadLeaderboard();
loadUserBets();
} else {
window.location.href = "login.html";
}
});
</script>
</body>
</html>
